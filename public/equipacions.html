<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <title>Equipacions</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/picnic">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.7/handlebars.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-serialize-object/2.5.0/jquery.serialize-object.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/navigo@8.11.1/lib/navigo.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    th {
      color: black !important;
      background-color: #f8f9fa; /* opcional para visibilidad */
    }
  </style>

</head>
<body>
<h1>Equipacions</h1>
<p><a href="/index.html">Torna a l'inici</a></p>

<div id="equipacions-container"></div>
<div id="equipacio-form"></div>

<script id="equipacions-template" type="text/x-handlebars-template">
  <p><a href="#/add" class="btn btn-primary">Afegir equipaci贸</a></p>
  <table class="table table-bordered">
    <thead>
    <tr><th>ID</th>
      <th>Tipus</th>
      <th>Colors</th>
      <th>Imatge</th>
      <th>Accions</th>
    </tr>
    </thead>
    <tbody>
    {{#each equipacions}}
      <tr>
        <td>{{id}}</td>
        <td>{{tipus}}</td>
        <td>{{colors}}</td>
        <td><img src="{{imatge}}" alt="Equipaci贸" style="max-height:60px;"></td>
        <td>
          <a href="#/modify/{{id}}" class="btn btn-warning">Modificar</a>
          <a href="#/delete/{{id}}" class="btn btn-danger">Eliminar</a>
        </td>
      </tr>
    {{/each}}
    </tbody>
  </table>
</script>

<script id="add_equipacio_template" type="text/x-handlebars-template">
  <h2>Afegir nova equipaci贸</h2>
  <form id="add_equipacio_form">

    <label>ID</label>
    <input name="id" value="{{equipacio.id}}"></input>
    <label>Tipus</label>
    <select name="tipus" class="form-control">
      <option value="Primera">Primera</option>
      <option value="Segona">Segona</option>
      <option value="Tercera">Tercera</option>
    </select>

    <label>Color principal</label>
    <input name="colors" class="form-control">

    <label>Temporada</label>
    <input name="temporada" class="form-control">
    <label>Imatge (URL)</label>
    <input name="imatge" class="form-control">


    <button type="submit" class="btn btn-primary mt-2">Crear</button>
  </form>
</script>


<script id="Modify-equipacions-template" type="text/x-handlebars-template">
  <h2>Modificar equipaci贸</h2>
  <form id="Modify-equipacio-form">
    <label>Id</label>
    <input  name="id" value="{{equipacio.id}}">
    <label>Tipus</label>
    <input name="tipus" value="{{equipacio.tipus}}" class="form-control" required>
    <label>Color</label>
    <input name="colors" value="{{equipacio.colors}}" class="form-control" required>
    <label>Imatge (URL)</label>
    <input name="imatge" value="{{equipacio.imatge}}" class="form-control">

    <button type="submit" class="btn btn-success mt-2">Guardar</button>
  </form>
</script>

<script>
  const router = new Navigo('/', { hash: true });

  function loadTeams(cb) {
    $.getJSON('/api/teams', d => cb(d.teams || d));
  }

  function showEquipacions() {
    $.getJSON('/api/equipacions', data => {
      const template = Handlebars.compile($('#equipacions-template').html());
      $('#equipacions-container').html(template({ equipacions: data.equipacions }));
      $('#equipacio-form').empty();
    });
  }

  function initAddEquipacio() {
    const template = Handlebars.compile($('#add_equipacio_template').html());
    $('#equipacio-form').html(template());
    $('#add_equipacio_form').on('submit', e => {
      e.preventDefault();
      $.post('/api/equipacions', $(e.target).serializeObject())
              .done(() => {
                router.navigate('/');
                showEquipacions();
              });
    });
  }

  function initModifyEquipacio({ data }) {
    const id = data.id;
    $.getJSON(`/api/equipacions/${id}`, d => {
      const template = Handlebars.compile($('#Modify-equipacions-template').html());
      $('#equipacio-form').html(template({ equipacio: d.equipacio }));
      $('#Modify-equipacio-form').on('submit', e => {
        e.preventDefault();
        $.ajax({
          url: `/api/equipacions/${id}`,
          type: 'PUT',
          data: $(e.target).serializeObject()
        }).done(() => router.navigate('/'));
      });
    });
  }

  function deleteEquipacio({ data }) {
    $.ajax({
      url: `/api/equipacions/${data.id}`,
      type: 'DELETE'
    }).done(() => router.navigate('/'));
  }

  router
          .on('/', showEquipacions)
          .on('/equipacions.html', showEquipacions)
          .on('/add', initAddEquipacio)
          .on('/modify/:id', initModifyEquipacio)
          .on('/delete/:id', deleteEquipacio)
          .resolve();

  $(document).ready(() => {
    router.resolve();
  });
</script>
</body>
</html>
